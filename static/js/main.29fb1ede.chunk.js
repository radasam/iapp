(this.webpackJsonpiapp=this.webpackJsonpiapp||[]).push([[0],{33:function(e,t,a){e.exports=a(62)},38:function(e,t,a){},62:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(30),l=a.n(c),u=(a(38),a(1)),o=a(7),s=a.n(o),i=a(12),m=a(9),d=Object(n.createContext)(),p=function(e,t){switch(t.type){case"GET_STATUS":return Object(u.a)(Object(u.a)({},e),{},{pumpStatus:t.payload,loaded:!0});case"GET_SENSOR_DATA":return Object(u.a)(Object(u.a)({},e),{},{sensordata:t.payload});default:return e}},h=a(10),E=a.n(h),g=function(e){e?E.a.defaults.headers.common["x-auth-token"]=e:delete E.a.defaults.headers.common["x-auth-token"]},y=function(e){var t=Object(n.useReducer)(p,{pumpStatus:{pumpid:1,type:"off",times:[""],days:[""],durations:[""],threshold:2e4},loaded:!1,sensordata:[]}),a=Object(m.a)(t,2),c=a[0],l=a[1],o=function(){var e=Object(i.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.token&&g(localStorage.token),e.next=3,E.a.get("/pump/status/"+t,{crossdomain:!0});case 3:a=e.sent,console.log(a.data.status.type),e.t0=a.data.status.type,e.next="off"===e.t0?8:"schedule"===e.t0?10:"scheduleday"===e.t0?11:13;break;case 8:return l({type:"GET_STATUS",payload:{pumpid:a.data.status.pumpid,type:"off",times:[""],days:[""],durations:[""],threshold:2e4}}),e.abrupt("break",13);case 10:l({type:"GET_STATUS",payload:{pumpid:a.data.status.pumpid,type:a.data.status.type,times:a.data.status.times,days:[""],durations:a.data.status.durations,threshold:2e4}});case 11:return l({type:"GET_STATUS",payload:{pumpid:a.data.status.pumpid,type:a.data.status.type,times:a.data.status.times,days:a.data.status.days,durations:a.data.status.durations,threshold:2e4}}),e.abrupt("break",13);case 13:y(t);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=function(){var e=Object(i.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:switch(localStorage.token&&g(localStorage.token),t.type){case"off":t=Object(u.a)(Object(u.a)({},t),{},{times:[""],days:[""],durations:[""],threshold:2e4});case"schedule":t=Object(u.a)(Object(u.a)({},t),{},{days:[""],threshold:2e4})}return e.next=4,E.a.post("/pump/status",t);case 4:a=e.sent,console.log(a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(i.a)(s.a.mark((function e(t){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.token&&g(localStorage.token),e.next=3,E.a.get("/sensor/log/"+t,{crossdomain:!0});case 3:a=e.sent,l({type:"GET_SENSOR_DATA",payload:a.data.records});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(i.a)(s.a.mark((function e(t,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.token&&g(localStorage.token),e.next=3,E.a.get("/pump/run/"+t+"/"+a);case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();return r.a.createElement(d.Provider,{value:{pumpStatus:c.pumpStatus,loaded:c.loaded,sensordata:c.sensordata,getStatus:o,updateStatus:h,runPump:f}},e.children)},f=a(11),b=Object(n.createContext)(),v=function(){var e=Object(n.useContext)(b),t=e.isAuthenticated,a=e.logout,c=r.a.createElement("li",null,r.a.createElement(f.b,{to:"/login"},"Login")),l=r.a.createElement(n.Fragment,null,r.a.createElement("li",null,r.a.createElement(f.b,{to:"/"},"Pumps")),r.a.createElement("li",null,r.a.createElement(f.b,{to:"/camera"},"Camera")),r.a.createElement("li",null,r.a.createElement("a",{onClick:a,href:"#!"},"Logout")));return r.a.createElement("div",{className:"navbar"},r.a.createElement("ul",null,t?l:c))},O=a(2),j=function(e){var t=e.onChange,a=e.className,n=e.name,c=e.childkey,l=e.day;return r.a.createElement("select",{className:a,key:c,name:n,type:"text",onChange:t},r.a.createElement("option",{value:l,hidden:!0},l),r.a.createElement("option",{value:"Monday"},"Monday"),r.a.createElement("option",{value:"Tuesday"},"Tuesday"),r.a.createElement("option",{value:"Wednesday"},"Wednesday"),r.a.createElement("option",{value:"Thursday"},"Thursday"),r.a.createElement("option",{value:"Friday"},"Friday"),r.a.createElement("option",{value:"Saturday"},"Saturday"),r.a.createElement("option",{value:"Sunday"},"Sunday"))},x=function(e){var t=e.type,a=e.onChange;return r.a.createElement("select",{name:"type",type:"text",onChange:a},r.a.createElement("option",{value:t},"scheduleday"==t?"Schedule Day":t.charAt(0).toUpperCase()+t.slice(1)),r.a.createElement("option",{value:"off"},"Off"),r.a.createElement("option",{value:"auto"},"Auto"),r.a.createElement("option",{value:"schedule"},"Schedule"),r.a.createElement("option",{value:"scheduleday"},"Schedule Day"))},S=function(){var e=Object(n.useContext)(d),t=Object(n.useState)({pumpid:1,type:"off",times:[""],days:[""],durations:[""],threshold:2e4}),a=Object(m.a)(t,2),c=a[0],l=a[1],o=e.pumpStatus,s=e.getStatus,i=e.updateStatus,p=e.loaded,h=e.runPump;Object(n.useEffect)((function(){p||s(1),l(o)}),[o]);var E=c.pumpid,g=c.type,y=c.days,f=c.times,b=c.durations,v=(c.threshold,function(e){"type"===e.target.name?l(Object(u.a)(Object(u.a)({},c),{},{type:e.target.value})):e.target.name.includes("day")?l(Object(u.a)(Object(u.a)({},c),{},{days:[].concat(y.slice(0,parseInt(e.target.name.replace("day-",""))),e.target.value,y.slice(parseInt(e.target.name.replace("day-",""))+1,y.length))})):e.target.name.includes("time")?l(Object(u.a)(Object(u.a)({},c),{},{times:[].concat(f.slice(0,parseInt(e.target.name.replace("time-",""))),e.target.value,f.slice(parseInt(e.target.name.replace("time-",""))+1,f.length))})):e.target.name.includes("duration")&&l(Object(u.a)(Object(u.a)({},c),{},{durations:[].concat(b.slice(0,parseInt(e.target.name.replace("duration-",""))),e.target.value,b.slice(parseInt(e.target.name.replace("duration-",""))+1,b.length))}))}),O=function(){l("scheduleday"===g?Object(u.a)(Object(u.a)({},c),{},{days:y.concat(""),times:f.concat(""),durations:b.concat("")}):Object(u.a)(Object(u.a)({},c),{},{times:f.concat(""),durations:b.concat("")}))};return r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"pumpsettings"},r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"type"},"Type"),r.a.createElement(x,{type:g,onChange:v})),"scheduleday"===g?r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"multi-form-group four"},r.a.createElement("label",{className:"multi-form-title"},"Schedule"),r.a.createElement("div",{className:"col2"},"Days"),r.a.createElement("div",{className:"col3"},"Times"),r.a.createElement("div",{className:"col4"},"Durations"),y.map((function(e,t){return r.a.createElement(j,{onChange:v,className:"col2",name:"day-"+t,childkey:"day-"+t,day:e})})),f.map((function(e,t){return r.a.createElement("input",{onChange:v,className:"col3",name:"time-"+t,key:"time-"+t,type:"time",value:e})})),b.map((function(e,t){return r.a.createElement("input",{onChange:v,className:"col4",name:"duration-"+t,key:"duration-"+t,type:"text",value:e})}))),r.a.createElement("span",{className:"btn btn-right",onClick:O},"+")):"schedule"===g?r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"multi-form-group"},r.a.createElement("label",{className:"multi-form-title"},"Schedule"),r.a.createElement("div",{className:"col2"},"Times"),r.a.createElement("div",{className:"col3"},"Durations"),f.map((function(e,t){return r.a.createElement("input",{onChange:v,className:"col2",name:"time-"+t,key:"time-"+t,type:"time",value:e})})),b.map((function(e,t){return r.a.createElement("input",{onChange:v,className:"col3",name:"duration-"+t,key:"duration-"+t,type:"text",value:e})}))),r.a.createElement("span",{className:"btn btn-right",onClick:O},"+")):"auto"===g?r.a.createElement(n.Fragment,null,r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"threshold"},"Threshold"),r.a.createElement("input",{type:"text",name:"threshold"})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"duration"},"Duration"),r.a.createElement("input",{type:"text",name:"duration"}))):r.a.createElement("div",null)),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("span",{className:"btn btn-right",onClick:function(e){return i(c)}},"Update"),r.a.createElement("br",null),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"rundur"},r.a.createElement("span",{className:"btn",onClick:function(e){return h(E,document.getElementById("rundur").value)}},"Run Pump")),r.a.createElement("input",{style:{marginRight:"2%"},id:"rundur",type:"number",name:"rundur",step:"0.5"}),r.a.createElement("span",null,"Sec"))))},k=a(16),N=function(){var e=Object(n.useContext)(d).sensordata;return Object(n.useEffect)((function(){k.a.load((function(){var t=k.a.api.visualization.arrayToDataTable(e.map((function(e,t){return 0==t?e:[new Date(e[0]),e[1]]}))),a={title:"Moisture Reading",vAxis:{viewWindow:{max:1.1*Math.max.apply(Math,e.slice(1).map((function(e,t){return e[1]}))),min:.9*Math.min.apply(Math,e.slice(1).map((function(e,t){return e[1]})))}},chartArea:{width:"94%"}};new k.a.api.visualization.LineChart(document.getElementById("chart")).draw(t,a)}))}),[e]),r.a.createElement("div",{id:"chart"})},C=function(){var e=Object(n.useContext)(d),t=e.pumpStatus,a=e.getStatus,c=t.pumpid;return r.a.createElement("div",null,r.a.createElement("div",{className:"pump"},r.a.createElement("h1",null,"Pump ",c),r.a.createElement("span",{className:"btn",onClick:function(){c>1&&a(c-1)}},"Prev"),r.a.createElement("span",{className:"btn",onClick:function(){c<4&&a(c+1)}},"Next"),r.a.createElement(N,null),r.a.createElement(S,null)))},T=a(15),w=function(e){var t=Object(n.useContext)(b),a=t.login,c=t.isAuthenticated;Object(n.useEffect)((function(){c&&e.history.push("/")}),[c]);var l=Object(n.useState)({username:"",password:""}),o=Object(m.a)(l,2),s=o[0],i=o[1],d=s.username,p=s.password,h=function(e){i(Object(u.a)(Object(u.a)({},s),{},Object(T.a)({},e.target.name,e.target.value)))};return r.a.createElement("div",{className:"pump"},r.a.createElement("h1",null,"Login"),r.a.createElement("div",{className:"pumpsettings"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"username"},"Username"),r.a.createElement("input",{name:"username",type:"text",value:d,onChange:h})),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"password"},"Password"),r.a.createElement("input",{name:"password",type:"password",value:p,onChange:h})),r.a.createElement("span",{onClick:function(e){return function(e){e.preventDefault(),""===d&&""===p||a({username:d,password:p})}(e)},className:"btn btn-right"},"Login")))},I=function(){var e=Object(n.useState)(0),t=Object(m.a)(e,2),a=t[0],c=t[1];Object(n.useEffect)((function(){var e;document.getElementById("imagebox-curr").innerHTML='<img style="max-width:100%;height:auto;" src="/pic/'+a+'">',document.getElementById("imagebox-prev").innerHTML='<img style="max-width:100%;height:auto;display:none;" src="/pic/'+parseInt(a-1)+'">',document.getElementById("imagebox-prev-2").innerHTML='<img style="max-width:100%;height:auto;display:none;" src="/pic/'+parseInt(a-2)+'">',document.getElementById("imagebox-curr").addEventListener("touchstart",(function(t){e=t.changedTouches[0].screenX})),document.getElementById("imagebox-curr").addEventListener("touchend",(function(t){e>t.changedTouches[0].screenX+50?l():e<t.changedTouches[0].screenX-50&&u()}))}),[]);var l=function(){a<0&&(document.getElementById("imagebox-curr").innerHTML='<img style="max-width:100%;height:auto;" src="/pic/'+parseInt(a+1)+'">',c(a+1))},u=function(){if(a<=0){var e=parseInt(a-1);document.getElementById("imagebox-curr").innerHTML='<img style="max-width:100%;height:auto;" src="/pic/'+e+'">',c(parseInt(a-1)),document.getElementById("imagebox-prev").innerHTML='<img style="max-width:100%;height:auto;display:none;" src="/pic/'+parseInt(a-2)+'">',document.getElementById("imagebox-prev-2").innerHTML='<img style="max-width:100%;height:auto;display:none;" src="/pic/'+parseInt(a-3)+'">'}};return r.a.createElement("div",{className:"pump"},r.a.createElement("div",{id:"imagebox-prev-2"}),r.a.createElement("div",{id:"imagebox-prev"}),r.a.createElement("div",{id:"imagebox-curr"}),r.a.createElement("span",{className:"btn",onClick:u},"Prev"),r.a.createElement("span",{className:"btn",onClick:l},"Next"))},A=function(e,t){switch(t.type){case"LOGIN_SUCCESS":return localStorage.setItem("token",t.payload.token),Object(u.a)(Object(u.a)(Object(u.a)({},e),t.payload),{},{isAuthenticated:!0,loading:!1});case"LOGIN_FAIL":case"AUTH_ERROR":case"LOGOUT":return localStorage.removeItem("token"),Object(u.a)(Object(u.a)({},e),{},{token:!1,isAuthenticated:!1,loading:!1,username:null,error:t.payload});case"CLEAR_ERRORS":return Object(u.a)(Object(u.a)({},e),{},{error:null});default:return e}},L=function(e){var t={token:localStorage.getItem("token"),isAuthenticated:!1,loading:!1,username:null},a=Object(n.useReducer)(A,t),c=Object(m.a)(a,2),l=c[0],u=c[1],o=function(){var e=Object(i.a)(s.a.mark((function e(t){var a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={headers:{"Content-Type":"application/json"}},e.prev=1,e.next=4,E.a.post("/auth",t,a);case 4:n=e.sent,u({type:"LOGIN_SUCCESS",payload:n.data}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),u({type:"LOGIN_FAIL",payload:e.t0.response.data.msg});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(b.Provider,{value:{token:l.token,isAuthenticated:l.isAuthenticated,loading:l.loading,username:l.username,login:o,logout:function(){u({type:"LOGOUT"})},clearErrors:function(){u({type:"CLEAR_ERRORS"})}}},e.children)},R=a(32),F=function(e){var t=e.component,a=Object(R.a)(e,["component"]),c=Object(n.useContext)(b),l=c.isAuthenticated,u=c.loading;return r.a.createElement(O.b,Object.assign({},a,{render:function(e){return l||u?r.a.createElement(t,e):r.a.createElement(O.a,{to:"/login"})}}))};var M=function(){return r.a.createElement(L,null,r.a.createElement(y,null,r.a.createElement("div",{className:"App"},r.a.createElement(f.a,null,r.a.createElement(v,null),r.a.createElement(O.d,null,r.a.createElement(F,{exact:!0,path:"/",component:C}),r.a.createElement(F,{exact:!0,path:"/camera",component:I}),r.a.createElement(O.b,{exact:!0,path:"/login",component:w}))))))};l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.29fb1ede.chunk.js.map